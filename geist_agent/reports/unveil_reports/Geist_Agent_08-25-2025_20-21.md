# Unveil: Codebase Map

_Root_: `Geist-Agent`  
_Files summarized_: **13**

## Overview

# Unveil: Codebase Map Overview

- **Entry Points**: `geist_agent/src/geist_agent/__init__.py` serves as the initial entry point for the GeistAgent module. `geist_agent/src/geist_agent/parse.py` handles command-line argument parsing, and `geist_agent/src/geist_agent/main.py` is the main execution entry point.
- **Main Flows**:
  - Parsing arguments via `parse.py` initializes the agent.
  - The workflow starts in `main.py`, which configures agents using settings from `unveil_runner.py` and runs them through `unveil_agent.py`.
  - For diagnostics, use `doctor.py`. For CLI interactions, `poltern.py` provides a user interface for various functionalities like scrying and codebase unveiling.
- **Collaboration**: Agents in `scrying.py`, configured by `unveil_agent.py`, work together to perform tasks specified in `unveil_runner.py`.
- **Key Components**:
  - `crew.py`: Manages the agent crew, including researchers and analysts.
  - `utils.py`: Provides utility functions for report generation and environment variable management.
  - `tools/__init__.py` and `custom_tool.py`: Define custom tools using the BaseTool framework from `crewai.tools`.
- **Notable Patterns**: The project leverages a modular structure with clear separation of concerns, making it easy to extend or modify individual components.

## Components

### geist_agent

- `geist_agent/src/geist_agent/__init__.py`
- `geist_agent/src/geist_agent/crew.py`
- `geist_agent/src/geist_agent/doctor.py`
- `geist_agent/src/geist_agent/main.py`
- `geist_agent/src/geist_agent/parse.py`
- `geist_agent/src/geist_agent/poltern.py`
- `geist_agent/src/geist_agent/scrying.py`
- `geist_agent/src/geist_agent/tools/__init__.py`
- `geist_agent/src/geist_agent/tools/custom_tool.py`
- `geist_agent/src/geist_agent/unveil_agent.py`
- `geist_agent/src/geist_agent/unveil_runner.py`
- `geist_agent/src/geist_agent/unveil_tools.py`
- `geist_agent/src/geist_agent/utils.py`

## Dependency Graph

```mermaid
graph TD
```

## Files

### `geist_agent/src/geist_agent/__init__.py`
**Role:** Entry point and initialization for the GeistAgent module
**API:** initialize_geist_agent
**Summary:**
- Serves as the main entry point for initializing the GeistAgent.
- Contains the `initialize_geist_agent` function which sets up the agent's environment.
- Exports the initialization function to be used by other modules or scripts.
- Likely interacts with internal configurations and dependencies defined within the package.
- No external dependencies, primarily relies on internal modules of the GeistAgent package.

### `geist_agent/src/geist_agent/crew.py`
**Role:** Defines a GeistAgent crew with researchers and reporting analysts tasks
**API:** GeistAgent, researcher, reporting_analyst, research_task, reporting_task, crew
**Summary:**
- This file defines the `GeistAgent` class, which is a CrewAI crew that includes researchers and reporting analysts tasks.
- It uses the `@agent`, `@task`, and `@crew` decorators to define the roles of agents and tasks within the crew.
- The researcher agent is configured with a specific research task, while the reporting analyst agent generates a report.
- The `crew` method creates the GeistAgent crew with specified configurations.
- It also references YAML configuration files for agents and tasks.

### `geist_agent/src/geist_agent/doctor.py`
**Role:** Health check and diagnostics for Geist Agent
**API:** run
**Summary:**
- This file defines health checks for the Geist Agent application.
- It includes various checks such as package version, environment variables, Ollama model availability, and report write permissions.
- The results of these checks are rendered using Rich library to provide a user-friendly output in the console.
- Checks can be executed either by printing JSON data or displaying a summary and detailed table.

### `geist_agent/src/geist_agent/main.py`
**Role:** Entry point for running GeistAgent operations
**API:** run, train, replay, test
**Summary:**
- This file serves as the main entry point for running GeistAgent operations, providing functions to run, train, replay, and test the agent.
- It uses a `GeistAgent` instance to perform its tasks, which can be customized via inputs like topic and current year.
- Error handling is implemented in each function to catch and raise exceptions for better debugging and user feedback.
- The functions accept command-line arguments, making them flexible for different use cases.

### `geist_agent/src/geist_agent/parse.py`
**Role:** Parses command-line arguments for the Geist agent tool
**API:** parse_args
**Summary:**
- The file defines a single public function `parse_args` which is responsible for parsing command-line arguments.
- It uses the argparse library to create a parser with subcommands, specifically handling 'scry' as one of them.
- The 'scry' subcommand allows users to specify a topic for Geist to research, providing default and custom options.
- It moves the global help option (-h/--help) to the options section instead of the main argument group.
- The function returns parsed command-line arguments.

### `geist_agent/src/geist_agent/poltern.py`
**Role:** CLI interface for various agent functionalities including scrying, doctor diagnostics, and codebase unveiling.
**API:** app, scry, doctor, unveil_cmd
**Summary:**
- This file defines the command-line interface (CLI) entry points for an agent named 'Poltergeist', providing functionalities to scry topics, perform diagnostics, and unveil codebase details.
- The `scry` function allows users to research a topic and write reports based on the input provided.
- The `doctor` function runs diagnostic checks on the environment and tools used by the agent, emitting JSON output if requested.
- The `unveil_cmd` function scans an agentic codebase for summaries, components, dependency graphs, and generates Markdown outputs.
- Entry point `main()` is defined to start the CLI application.

### `geist_agent/src/geist_agent/scrying.py`
**Role:** ScryingAgent for divination and research operations with tasks and agents configuration
**API:** ScryingAgent, set_topic, researcher, reporting_analyst, research_task, reporting_task, scrying
**Summary:**
- This class handles Scrying operations, which include setting a topic, creating researcher and reporting analyst agents, defining research and reporting tasks, and generating reports.
- The `set_topic` method sets the topic for filename generation.
- The `researcher` and `reporting_analyst` methods create Agents with specific configurations.
- The `research_task` and `reporting_task` methods define tasks related to research and reporting respectively, utilizing ReportUtils and PathUtils.
- The `scrying` method creates a Crew for sequential processing.

### `geist_agent/src/geist_agent/tools/__init__.py`
**Role:** Entry point for geist_agent tools
**API:** configure_tool, run_tool, list_tools
**Summary:**
- Serves as the main entry point for managing and executing various tools within the geist_agent framework.
- Exports functions to configure, run, and list available tools that can be utilized by other parts of the system.
- Facilitates dynamic loading and management of tools without requiring explicit imports in consuming modules.
- Provides a centralized location for tool initialization and configuration settings.
- Interacts with internal geist_agent modules to manage tool dependencies and execution contexts.

### `geist_agent/src/geist_agent/tools/custom_tool.py`
**Role:** Defines a custom tool for an agent using the BaseTool framework from crewai.tools
**API:** MyCustomToolInput, MyCustomTool
**Summary:**
- The file defines an input model `MyCustomToolInput` using Pydantic for handling tool arguments.
- It also creates the `MyCustomTool` class, which inherits from `BaseTool` and specifies its argument schema as `MyCustomToolInput`.
- The `_run` method is a placeholder that returns a hardcoded string; this should be implemented with actual functionality.
- This custom tool can be used by an agent to perform specific tasks based on the provided input arguments.

### `geist_agent/src/geist_agent/unveil_agent.py`
**Role:** Configures and runs agents to unveil specific tasks in a project
**API:** UnveilCrew.file_analyst(), UnveilCrew.linker(), UnveilCrew.architect(), UnveilCrew.scan_and_summarize(), UnveilCrew.cross_link(), UnveilCrew.repo_narrative_and_render(), UnveilCrew.unveal()
**Summary:**
- Loads and processes configuration files for specific tasks starting with 'unveil_'
- Defines agents (file_analyst, linker, architect) using configurations from YAML files
- Optional tasks like scan_and_summarize, cross_link, repo_narrative_and_render are defined
- Maps tasks to a sequential process and runs them within a crew framework
- Excludes non-unveil tasks by only loading configurations that start with 'unveil_'

### `geist_agent/src/geist_agent/unveil_runner.py`

### `geist_agent/src/geist_agent/unveil_tools.py`
**Role:** Tool for generating dependency reports of files within a project
**API:** _format_api_list, _format_summary_list, walk_files, chunk_file, static_imports, _resolve_token_to_file, infer_edges_and_externals, components_from_paths, _mermaid, render_report
**Summary:**
- The file contains functions for generating dependency reports of files within a project.
- It includes utilities for chunking text, formatting API and summary strings, walking through files, resolving import tokens, inferring dependencies, identifying components, creating mermaid graphs, and rendering reports.
- Functions process various types of files (Python, JavaScript/TypeScript, C/C++, SQL) based on their file extensions.
- It also includes mechanisms to exclude certain directories and files during traversal.
- The core functionality revolves around generating a dependency graph and summarizing the contents and APIs of files.

### `geist_agent/src/geist_agent/utils.py`
**Role:** Utility functions for report generation and environment variable management
**API:** ReportUtils.generate_filename, EnvUtils.load_env_for_tool, PathUtils.geist_app_root, PathUtils.ensure_reports_dir
**Summary:**
- The file contains utility functions for generating filenames and managing environment variables.
- ReportUtils provides a static method to generate filenames based on topic and timestamp, ensuring compatibility with Windows filenames.
- EnvUtils offers a static method to load environment variables in a specified order of precedence, including user-specific directories and default paths.
- PathUtils includes methods to resolve the Geist app root and ensure the existence of a reports directory for storing generated reports.

## External Dependencies (inferred)

- `typing` ×10
- `pathlib` ×7
- `crewai` ×5
- `os` ×5
- `geist_agent.utils` ×5
- `__future__` ×4
- `crewai.project` ×3
- `crewai.agents.agent_builder.base_agent` ×3
- `datetime` ×3
- `typer` ×2
- `sys` ×2
- `yaml` ×2
- `dataclasses` ×1
- `importlib.metadata` ×1
- `rich.console` ×1
- `rich.table` ×1
- `rich.panel` ×1
- `rich.text` ×1
- `rich.markdown` ×1
- `warnings` ×1
- `geist_agent.crew` ×1
- `geist_agent.customCrew` ×1
- `argparse` ×1
- `geist_agent.scrying` ×1
- `geist_agent` ×1
- `geist_agent.unveil_runner` ×1
- `json` ×1
- `time` ×1
- `geist_agent.unveil_tools` ×1
- `collections` ×1
- `re` ×1
- `dotenv` ×1
- `crewai.tools` ×1
- `pydantic` ×1
